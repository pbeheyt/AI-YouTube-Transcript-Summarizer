(()=>{var e={405:(e,t,o)=>{"use strict";o.r(t),o.d(t,{YoutubeTranscript:()=>g,YoutubeTranscriptDisabledError:()=>l,YoutubeTranscriptError:()=>i,YoutubeTranscriptNotAvailableError:()=>d,YoutubeTranscriptNotAvailableLanguageError:()=>u,YoutubeTranscriptTooManyRequestError:()=>s,YoutubeTranscriptVideoUnavailableError:()=>c});const r=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i,a="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36,gzip(gfe)",n=/<text start="([^"]*)" dur="([^"]*)">([^<]*)<\/text>/g;class i extends Error{constructor(e){super(`[YoutubeTranscript] 🚨 ${e}`)}}class s extends i{constructor(){super("YouTube is receiving too many requests from this IP and now requires solving a captcha to continue")}}class c extends i{constructor(e){super(`The video is no longer available (${e})`)}}class l extends i{constructor(e){super(`Transcript is disabled on this video (${e})`)}}class d extends i{constructor(e){super(`No transcripts are available for this video (${e})`)}}class u extends i{constructor(e,t,o){super(`No transcripts are available in ${e} this video (${o}). Available languages: ${t.join(", ")}`)}}class g{static fetchTranscript(e,t){var o,r,i,g,p;return r=this,i=void 0,p=function*(){const r=this.retrieveVideoId(e),i=yield fetch(`https://www.youtube.com/watch?v=${r}`,{headers:Object.assign(Object.assign({},(null==t?void 0:t.lang)&&{"Accept-Language":t.lang}),{"User-Agent":a})}),g=yield i.text(),p=g.split('"captions":');if(p.length<=1){if(g.includes('class="g-recaptcha"'))throw new s;if(!g.includes('"playabilityStatus":'))throw new c(e);throw new l(e)}const v=null===(o=(()=>{try{return JSON.parse(p[1].split(',"videoDetails')[0].replace("\n",""))}catch(e){return}})())||void 0===o?void 0:o.playerCaptionsTracklistRenderer;if(!v)throw new l(e);if(!("captionTracks"in v))throw new d(e);if((null==t?void 0:t.lang)&&!v.captionTracks.some((e=>e.languageCode===(null==t?void 0:t.lang))))throw new u(null==t?void 0:t.lang,v.captionTracks.map((e=>e.languageCode)),e);const h=((null==t?void 0:t.lang)?v.captionTracks.find((e=>e.languageCode===(null==t?void 0:t.lang))):v.captionTracks[0]).baseUrl,b=yield fetch(h,{headers:Object.assign(Object.assign({},(null==t?void 0:t.lang)&&{"Accept-Language":t.lang}),{"User-Agent":a})});if(!b.ok)throw new d(e);return[...(yield b.text()).matchAll(n)].map((e=>{var o;return{text:e[3],duration:parseFloat(e[2]),offset:parseFloat(e[1]),lang:null!==(o=null==t?void 0:t.lang)&&void 0!==o?o:v.captionTracks[0].languageCode}}))},new((g=void 0)||(g=Promise))((function(e,t){function o(e){try{n(p.next(e))}catch(e){t(e)}}function a(e){try{n(p.throw(e))}catch(e){t(e)}}function n(t){var r;t.done?e(t.value):(r=t.value,r instanceof g?r:new g((function(e){e(r)}))).then(o,a)}n((p=p.apply(r,i||[])).next())}))}static retrieveVideoId(e){if(11===e.length)return e;const t=e.match(r);if(t&&t.length)return t[1];throw new i("Impossible to retrieve Youtube video ID.")}}}},t={};function o(r){var a=t[r];if(void 0!==a)return a.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,o),n.exports}o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};const{YoutubeTranscript:r}=o(405);let a=!1;const n=()=>{const e=document.querySelector("h1.ytd-watch-metadata");return e?e.textContent.trim():"Title not found"},i=()=>{const e=document.querySelector("#header-text #title.ytd-video-description-infocards-section-renderer");if(!e){const e=document.querySelector("ytd-channel-name yt-formatted-string#text");return e?e.textContent.trim():"Channel not found"}return e.textContent.trim()},s=()=>{const e=document.querySelector('meta[name="description"]');return e?e.getAttribute("content"):"Description not available"},c=async()=>new Promise((e=>{chrome.storage.local.get(["youtubeVideoData"],(t=>{t.youtubeVideoData?console.log("Clearing existing transcript data:",t.youtubeVideoData.videoId||"Unknown ID"):console.log("No existing transcript data found"),chrome.storage.local.remove("youtubeVideoData",(()=>{console.log("Existing transcript data cleared"),e()}))}))})),l=async()=>{try{"complete"!==document.readyState&&await new Promise((e=>{window.addEventListener("load",e)})),await new Promise((e=>setTimeout(e,500))),console.log("Starting video data extraction...");const e=await(async()=>{try{const e=n(),t=i(),o=s(),a={views:"Not extracted",date:"Not extracted"},l=window.location.href,d=new URLSearchParams(window.location.search).get("v");console.log("Extracting transcript for video ID:",d),console.log("From URL:",l),await c();const u=await r.fetchTranscript(l),g=(e=>Array.isArray(e)&&0!==e.length?e.map((e=>e.text.trim())).join(" ").replace(/\s+/g," "):"No transcript data available")(u);return console.log("Transcript data extracted:",u.length,"segments"),{videoId:d,videoTitle:e,channelName:t,videoDescription:o,views:a.views,publishDate:a.date,transcript:g,transcriptLanguage:u.length>0?u[0].lang:"unknown",extractedAt:(new Date).toISOString()}}catch(e){console.error("Error extracting video data:",e);let t="Failed to extract transcript";return t=e.message&&e.message.includes("Transcript is disabled")?"Transcript is not available for this video. The creator may have disabled it.":e.message&&e.message.includes("No transcript available")?"No transcript is available for this video.":e.message&&e.message.includes("too many requests")?"YouTube is limiting transcript access due to too many requests. Please try again later.":e.message&&e.message.includes("unavailable")?"The video appears to be unavailable or private.":`Error getting transcript: ${e.message}`,{videoId:new URLSearchParams(window.location.search).get("v"),videoTitle:n(),channelName:i(),videoDescription:s(),views:"Not extracted",publishDate:"Not extracted",transcript:t,error:!0,message:t,extractedAt:(new Date).toISOString()}}})();chrome.storage.local.set({youtubeVideoData:e},(()=>{console.log("YouTube video data saved to storage for video:",e.videoId),console.log("Data extraction timestamp:",e.extractedAt)}))}catch(e){console.error("Error in YouTube content script:",e),chrome.storage.local.set({youtubeVideoData:{error:!0,message:e.message||"Unknown error occurred",extractedAt:(new Date).toISOString()}})}chrome.storage.local.get(["youtubeVideoData"],(function(e){console.log("VERIFICATION - Stored data:",e.youtubeVideoData),e.youtubeVideoData&&e.youtubeVideoData.transcript?console.log("✅ Transcript successfully extracted"):console.log("❌ Transcript extraction failed")}))};chrome.runtime.onMessage.addListener(((e,t,o)=>(console.log("Message received in content script:",e),"ping"===e.action?(console.log("Ping received, responding with pong"),o({status:"pong",ready:a}),!0):"extractTranscript"===e.action?(console.log("Extract transcript request received"),l(),o({status:"Extracting transcript..."}),!0):void 0))),console.log("YouTube transcript extractor content script loaded"),(async()=>{try{console.log("YouTube transcript extractor content script initializing..."),a=!0,console.log("YouTube transcript extractor content script ready"),window.location.href.includes("youtube.com/watch")&&(console.log("YouTube video page detected, preparing for transcript extraction"),setTimeout(l,1500))}catch(e){console.error("Error initializing content script:",e)}})()})();