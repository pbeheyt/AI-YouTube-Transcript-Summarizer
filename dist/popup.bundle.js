document.addEventListener("DOMContentLoaded",(async()=>{const e=document.getElementById("aiToggle"),t=document.getElementById("promptType"),a=document.getElementById("summarizeBtn"),o=document.getElementById("statusMessage"),{useClaudeAI:c,selectedPromptType:r}=await chrome.storage.local.get(["useClaudeAI","selectedPromptType"]);void 0!==c&&(e.checked=c),r&&(t.value=r),e.addEventListener("change",(()=>{chrome.storage.local.set({useClaudeAI:e.checked})})),t.addEventListener("change",(()=>{chrome.storage.local.set({selectedPromptType:t.value})})),a.addEventListener("click",(async()=>{try{const c=await chrome.tabs.query({active:!0,currentWindow:!0});if(!c[0].url.includes("youtube.com/watch"))return o.textContent="Not a YouTube video page. Please navigate to a video.",void(o.style.color="#ff6b6b");o.textContent="Extracting transcript...",o.style.color="#ccc",a.disabled=!0;const r=e.checked,s=t.value;await chrome.storage.local.set({useClaudeAI:r,selectedPromptType:s}),chrome.tabs.sendMessage(c[0].id,{action:"extractTranscript"});let n=!1,d=0;const i=15;for(;!n&&d<i;){await new Promise((e=>setTimeout(e,1e3)));const{youtubeVideoData:e}=await chrome.storage.local.get(["youtubeVideoData"]);if(e){if(n=!0,e.error)return o.textContent=e.message||"Failed to extract transcript",o.style.color="#ff6b6b",void(a.disabled=!1);const t=await fetch(chrome.runtime.getURL("config.json")),c=await t.json(),d=r?c.claudeUrl:c.chatgptUrl,i=c.prompts[s]||c.prompts.academic,l=await chrome.tabs.create({url:d,active:!1});await chrome.storage.local.set({aiTabId:l.id,scriptInjected:!1,prePrompt:i}),await chrome.tabs.update(l.id,{active:!0}),window.close()}else d++}n||(o.textContent="Timeout: Failed to extract transcript. Please try again.",o.style.color="#ff6b6b",a.disabled=!1)}catch(e){console.error("Error:",e),o.textContent=`Error: ${e.message||"Unknown error occurred"}`,o.style.color="#ff6b6b",a.disabled=!1}})),(async()=>{try{(await chrome.tabs.query({active:!0,currentWindow:!0}))[0].url.includes("youtube.com/watch")?(a.disabled=!1,o.textContent="Ready to summarize",o.style.color="#4caf50"):(a.disabled=!0,o.textContent="Please navigate to a YouTube video page",o.style.color="#ff6b6b")}catch(e){console.error("Error checking page:",e)}})()}));